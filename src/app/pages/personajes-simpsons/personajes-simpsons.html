<div>
  <h1>Personajes de Los Simpsons</h1>

  <table border="1">
    <thead>
      <tr>
        <th>Imagen</th>
        <th>ID</th>
        <th>Nombre</th>
        <th>Edad</th>
        <th>Genero</th>
        <th>Ocupacion</th>
        <th>Estado</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      @for (personaje of personajes; track personaje.id) {
        <tr>
          <td>
            <img
              [src]="getImagenPersonaje(personaje)"
              [alt]="personaje.name"
              width="200"
              height="200"
              loading="lazy"
            />
          </td>
          <td>{{ personaje.id }}</td>
          <td>{{ personaje.name }}</td>
          <td>{{ personaje.age }}</td>
          <td>{{ personaje.gender }}</td>
          <td>{{ personaje.occupation }}</td>
          <td>{{ personaje.status }}</td>
          <td>
            <button (click)="seleccionarPersonaje(personaje)">Ver Detalles</button>
          </td>
        </tr>
      }
    </tbody>
  </table>

  <!-- Panel de Detalles -->
  @if (personajeSeleccionado) {
    <div class="details-panel">
      <div class="details-header">
        <h2>Detalles de {{ personajeSeleccionado.name }}</h2>
        <button class="btn-close" (click)="cerrarDetalles()">X</button>
      </div>

      <div class="details-content">
        <div class="detail-row">
          <strong>ID:</strong> {{ personajeSeleccionado.id }}
        </div>
        <div class="detail-row">
          <strong>Género:</strong> {{ personajeSeleccionado.gender || 'No especificado' }}
        </div>
        <div class="detail-row">
          <strong>Edad:</strong> {{ personajeSeleccionado.age || 'No especificada' }}
        </div>
        <div class="detail-row">
          <strong>Ocupación:</strong> {{ personajeSeleccionado.occupation || 'Desconocida' }}
        </div>

        <div class="action-buttons">
          <button class="btn-action" (click)="verLocacion()">Ver Locación</button>
          <button class="btn-action" (click)="verEpisodios()">Ver Episodios</button>
        </div>

        <!-- Info Locación -->
        @if (locacionSeleccionada) 
        {

          <div class="extra-info location-box">
            <h3>Locación Sugerida</h3>
            <p>{{ locacionSeleccionada.name }}</p>
            <img *ngIf="locacionSeleccionada.image_path" src="https://cdn.thesimpsonsapi.com/500{{locacionSeleccionada.image_path}}" alt="{{locacionSeleccionada.name}}">
          </div>
        }

        <!-- Info Episodios -->
        @if (episodiosRelacionados.length > 0) 
        {
          <div class="extra-info episodes-box">
            <h3>Episodios Relacionados</h3>
            <ul>
              @for (ep of episodiosRelacionados; track ep.id) 
              {
                <li>
                  <strong>{{ ep.name }}</strong> 
                  <span class="season-info">(Temp {{ ep.season }} - Ep {{ ep.episode }})</span>
                  @if (ep.description) 
                  {
                    <p class="desc">{{ ep.description }}</p>
                  }
                </li>

              }
            </ul>

          </div>
        }
      </div>
    </div>
  }
</div>
